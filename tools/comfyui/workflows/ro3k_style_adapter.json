{
  "name": "Romance of Three Kingdoms Style Adapter - IP-Adapter Conditioning",
  "description": "Style consistency workflow using IP-Adapter for maintaining coherent ROTK visual style across all generated assets. Uses reference images for style guidance without copying specific content.",
  "version": "1.0.0",
  "workflow_type": "ro3k_style_adapter",
  
  "purpose": "Ensure visual consistency across all generated assets by using IP-Adapter style conditioning with carefully curated reference images. This workflow can be used standalone or integrated into other ro3k workflows.",
  
  "style_reference": {
    "approach": "IP-Adapter style-only transfer",
    "description": "Extract high-level style characteristics (lighting, color palette, brushwork, atmosphere) from reference images without copying specific content, characters, or compositions",
    "constraints": [
      "Use 1-3 reference images maximum",
      "Low-to-medium IP-Adapter strength (0.3-0.6) to preserve content originality",
      "Style-only mode when available to avoid content bleeding",
      "References should be diverse enough to represent style range"
    ]
  },
  
  "parameters": {
    "style_reference_images": {
      "type": "array",
      "max_items": 3,
      "description": "Paths to 1-3 style reference images (ROTK-style artwork, not copyrighted game assets)"
    },
    "ip_adapter_strength": {
      "type": "float",
      "min": 0.1,
      "max": 0.8,
      "default": 0.45,
      "description": "Strength of style influence. Lower = more original, Higher = more style-matched"
    },
    "ip_adapter_weight_type": {
      "type": "enum",
      "options": ["style_transfer", "composition", "original"],
      "default": "style_transfer",
      "description": "Weight type for IP-Adapter. style_transfer focuses on visual style only."
    },
    "combine_mode": {
      "type": "enum",
      "options": ["average", "concat", "first_only"],
      "default": "average",
      "description": "How to combine multiple reference images"
    },
    "content_prompt": {
      "type": "string",
      "required": true,
      "description": "The actual content to generate (character, scene, etc.)"
    },
    "seed": {
      "type": "integer",
      "default": -1
    }
  },
  
  "recommended_references": {
    "_comment": "Use original artwork that captures the ROTK aesthetic, not copyrighted game screenshots",
    "style_elements_to_capture": [
      "Warm gold/amber lighting with high contrast",
      "Semi-realistic painted illustration style",
      "Strong rim lighting on figures",
      "Muted jewel tone color palette",
      "Painterly soft gradients and brushwork",
      "Atmospheric haze and depth",
      "Ornate costume and armor details"
    ],
    "reference_sources": [
      "Original commissioned artwork in ROTK style",
      "Traditional Chinese historical painting reproductions",
      "Wuxia/historical fantasy book cover art",
      "Period-accurate costume reference photos (for style of rendering)",
      "Ink wash landscape paintings for background style"
    ],
    "avoid": [
      "Direct game screenshots (copyright issues)",
      "Specific copyrighted character art",
      "Modern anime style references",
      "Photorealistic references"
    ]
  },
  
  "style_prompt_enhancement": "Romance of Three Kingdoms painted style, KOEI Tecmo quality aesthetic, Dynasty Warriors visual approach, semi-realistic painted illustration, heroic historical-fantasy tone, warm cinematic lighting, luminous rim light, painterly soft gradients, Han dynasty aesthetic, professional game illustration quality",
  
  "workflow_nodes": {
    "1": {
      "class_type": "CheckpointLoaderSimple",
      "inputs": {
        "ckpt_name": "{CHECKPOINT_NAME}"
      },
      "_meta": {"title": "Load Checkpoint"}
    },
    "2": {
      "class_type": "IPAdapterModelLoader",
      "inputs": {
        "ipadapter_file": "ip-adapter-plus_sd15.bin"
      },
      "_meta": {"title": "Load IP-Adapter Model"}
    },
    "3": {
      "class_type": "CLIPVisionLoader",
      "inputs": {
        "clip_name": "clip-vit-h-14-laion2B-s32B-b79K.safetensors"
      },
      "_meta": {"title": "Load CLIP Vision"}
    },
    "4": {
      "class_type": "LoadImage",
      "inputs": {
        "image": "{STYLE_REFERENCE_1}"
      },
      "_meta": {"title": "Load Style Reference 1"}
    },
    "5": {
      "class_type": "LoadImage",
      "inputs": {
        "image": "{STYLE_REFERENCE_2}"
      },
      "_meta": {"title": "Load Style Reference 2 (Optional)"}
    },
    "6": {
      "class_type": "IPAdapterEncoder",
      "inputs": {
        "clip_vision": ["3", 0],
        "image": ["4", 0],
        "weight": "{IP_ADAPTER_STRENGTH}"
      },
      "_meta": {"title": "Encode Style Reference"}
    },
    "7": {
      "class_type": "IPAdapterApply",
      "inputs": {
        "ipadapter": ["2", 0],
        "clip_vision": ["3", 0],
        "image": ["4", 0],
        "model": ["1", 0],
        "weight": "{IP_ADAPTER_STRENGTH}",
        "weight_type": "style transfer"
      },
      "_meta": {"title": "Apply IP-Adapter Style"}
    },
    "8": {
      "class_type": "CLIPTextEncode",
      "inputs": {
        "text": "{POSITIVE_PROMPT}",
        "clip": ["1", 1]
      },
      "_meta": {"title": "CLIP Text Encode (Positive)"}
    },
    "9": {
      "class_type": "CLIPTextEncode",
      "inputs": {
        "text": "{NEGATIVE_PROMPT}",
        "clip": ["1", 1]
      },
      "_meta": {"title": "CLIP Text Encode (Negative)"}
    },
    "10": {
      "class_type": "EmptyLatentImage",
      "inputs": {
        "width": "{WIDTH}",
        "height": "{HEIGHT}",
        "batch_size": 1
      },
      "_meta": {"title": "Empty Latent Image"}
    },
    "11": {
      "class_type": "KSampler",
      "inputs": {
        "seed": "{SEED}",
        "steps": 30,
        "cfg": 7.0,
        "sampler_name": "dpmpp_2m",
        "scheduler": "karras",
        "denoise": 1.0,
        "model": ["7", 0],
        "positive": ["8", 0],
        "negative": ["9", 0],
        "latent_image": ["10", 0]
      },
      "_meta": {"title": "KSampler (with Style)"}
    },
    "12": {
      "class_type": "VAEDecode",
      "inputs": {
        "samples": ["11", 0],
        "vae": ["1", 2]
      },
      "_meta": {"title": "VAE Decode"}
    },
    "13": {
      "class_type": "SaveImage",
      "inputs": {
        "filename_prefix": "ro3k_styled",
        "images": ["12", 0]
      },
      "_meta": {"title": "Save Image"}
    }
  },
  
  "integration_guide": {
    "standalone_use": "Use this workflow directly to generate style-consistent assets",
    "integration_with_other_workflows": {
      "description": "Insert IP-Adapter nodes between checkpoint loader and KSampler in other ro3k workflows",
      "steps": [
        "1. After CheckpointLoaderSimple, add IPAdapterModelLoader and CLIPVisionLoader",
        "2. Load style reference image(s) with LoadImage",
        "3. Apply IP-Adapter with IPAdapterApply, outputting modified model",
        "4. Use modified model in KSampler instead of original model",
        "5. Keep strength at 0.3-0.5 to maintain prompt influence"
      ]
    }
  },
  
  "lora_alternative": {
    "_comment": "If IP-Adapter is not available or if stronger style enforcement is needed",
    "approach": "Use a trained LoRA for ROTK style",
    "lora_training_notes": {
      "dataset_requirements": "20-50 high-quality ROTK-style images (original artwork only)",
      "training_steps": "1500-3000 steps depending on dataset size",
      "recommended_lr": "1e-4 to 5e-5",
      "caption_format": "Include 'ro3k style' or 'rotk style' trigger word in all captions"
    },
    "lora_usage": {
      "node": "LoraLoader",
      "strength": "0.6-0.9 for strong style, 0.3-0.5 for subtle influence"
    }
  },
  
  "workflow_notes": "This workflow uses IP-Adapter for style conditioning. It requires: 1) IP-Adapter model files, 2) CLIP Vision encoder, 3) Style reference images. For best results, use original artwork references that capture the desired aesthetic without copying copyrighted content. The 'style transfer' weight type helps focus on visual style rather than content/composition.",
  
  "required_models": {
    "ip_adapter": {
      "name": "ip-adapter-plus_sd15.bin or ip-adapter-plus_sdxl.bin",
      "location": "ComfyUI/models/ipadapter/"
    },
    "clip_vision": {
      "name": "clip-vit-h-14-laion2B-s32B-b79K.safetensors",
      "location": "ComfyUI/models/clip_vision/"
    }
  }
}
