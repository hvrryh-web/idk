{
  "version": "1.0.0",
  "description": "Full Character Sheet Generator - Composite layout with portrait, poses, outfits, and stats zone",
  "workflow_notes": "Creates a complete character sheet combining all visual elements for TTRPG use",
  
  "output_config": {
    "output_size": {"width": 2560, "height": 1440},
    "sections": {
      "portrait": {
        "size": {"width": 512, "height": 768},
        "position": {"x": 32, "y": 336}
      },
      "poses": {
        "size": {"width": 768, "height": 512},
        "position": {"x": 576, "y": 32}
      },
      "outfits": {
        "size": {"width": 768, "height": 512},
        "position": {"x": 576, "y": 576}
      },
      "stats_zone": {
        "size": {"width": 256, "height": 768},
        "position": {"x": 1376, "y": 336},
        "transparent": true
      },
      "expressions": {
        "size": {"width": 512, "height": 128},
        "position": {"x": 32, "y": 1136}
      },
      "name_plate": {
        "size": {"width": 512, "height": 64},
        "position": {"x": 32, "y": 32}
      }
    }
  },
  
  "expressions_strip": {
    "count": 4,
    "expressions": [
      {"id": "neutral", "prompt": "neutral expression, calm face"},
      {"id": "angry", "prompt": "angry expression, fierce eyes, gritted teeth"},
      {"id": "happy", "prompt": "happy expression, gentle smile, warm eyes"},
      {"id": "determined", "prompt": "determined expression, focused eyes, resolute"}
    ]
  },
  
  "workflow": {
    "description": "Composite character sheet from pre-generated components",
    "nodes": {
      "canvas": {
        "class_type": "EmptyImage",
        "_comment": "Create base canvas",
        "inputs": {
          "width": 2560,
          "height": 1440,
          "color": "{{background_color}}"
        }
      },
      
      "load_portrait": {
        "class_type": "LoadImage",
        "inputs": {
          "image": "{{portrait_image}}"
        }
      },
      "resize_portrait": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_portrait", 0],
          "width": 512,
          "height": 768,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "place_portrait": {
        "class_type": "ImagePaste",
        "inputs": {
          "destination": ["canvas", 0],
          "source": ["resize_portrait", 0],
          "x": 32,
          "y": 336
        }
      },
      
      "load_poses": {
        "class_type": "LoadImage",
        "inputs": {
          "image": "{{poses_sheet_image}}"
        }
      },
      "resize_poses": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_poses", 0],
          "width": 768,
          "height": 512,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "place_poses": {
        "class_type": "ImagePaste",
        "inputs": {
          "destination": ["place_portrait", 0],
          "source": ["resize_poses", 0],
          "x": 576,
          "y": 32
        }
      },
      
      "load_outfits": {
        "class_type": "LoadImage",
        "inputs": {
          "image": "{{outfits_sheet_image}}"
        }
      },
      "resize_outfits": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_outfits", 0],
          "width": 768,
          "height": 512,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "place_outfits": {
        "class_type": "ImagePaste",
        "inputs": {
          "destination": ["place_poses", 0],
          "source": ["resize_outfits", 0],
          "x": 576,
          "y": 576
        }
      },
      
      "stats_zone_overlay": {
        "class_type": "SolidMask",
        "_comment": "Create transparent zone for stats overlay",
        "inputs": {
          "width": 256,
          "height": 768,
          "value": 0.3
        }
      },
      "stats_zone_color": {
        "class_type": "MaskToImage",
        "inputs": {
          "mask": ["stats_zone_overlay", 0],
          "color": "#000000"
        }
      },
      "place_stats_zone": {
        "class_type": "ImagePaste",
        "inputs": {
          "destination": ["place_outfits", 0],
          "source": ["stats_zone_color", 0],
          "x": 1376,
          "y": 336
        }
      },
      
      "load_expression_1": {
        "class_type": "LoadImage",
        "inputs": {"image": "{{expression_neutral}}"}
      },
      "load_expression_2": {
        "class_type": "LoadImage",
        "inputs": {"image": "{{expression_angry}}"}
      },
      "load_expression_3": {
        "class_type": "LoadImage",
        "inputs": {"image": "{{expression_happy}}"}
      },
      "load_expression_4": {
        "class_type": "LoadImage",
        "inputs": {"image": "{{expression_determined}}"}
      },
      "resize_expr_1": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_expression_1", 0],
          "width": 128,
          "height": 128,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "resize_expr_2": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_expression_2", 0],
          "width": 128,
          "height": 128,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "resize_expr_3": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_expression_3", 0],
          "width": 128,
          "height": 128,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "resize_expr_4": {
        "class_type": "ImageScale",
        "inputs": {
          "image": ["load_expression_4", 0],
          "width": 128,
          "height": 128,
          "upscale_method": "lanczos",
          "crop": "center"
        }
      },
      "expressions_row": {
        "class_type": "ImageBatch",
        "inputs": {
          "image1": ["resize_expr_1", 0],
          "image2": ["resize_expr_2", 0]
        }
      },
      "expressions_row_2": {
        "class_type": "ImageBatch",
        "inputs": {
          "image1": ["expressions_row", 0],
          "image2": ["resize_expr_3", 0]
        }
      },
      "expressions_strip_final": {
        "class_type": "ImageBatch",
        "inputs": {
          "image1": ["expressions_row_2", 0],
          "image2": ["resize_expr_4", 0]
        }
      },
      "place_expressions": {
        "class_type": "ImagePaste",
        "inputs": {
          "destination": ["place_stats_zone", 0],
          "source": ["expressions_strip_final", 0],
          "x": 32,
          "y": 1136
        }
      },
      
      "add_border": {
        "class_type": "ImageBorder",
        "_comment": "Add decorative border",
        "inputs": {
          "image": ["place_expressions", 0],
          "border_width": 4,
          "border_color": "#8B7355"
        }
      },
      
      "save_sheet": {
        "class_type": "SaveImage",
        "inputs": {
          "filename_prefix": "{{output_prefix}}_character_sheet",
          "images": ["add_border", 0]
        }
      }
    }
  },
  
  "expression_generation_workflow": {
    "description": "Generate individual expression images for the strip",
    "nodes": {
      "1": {
        "class_type": "CheckpointLoaderSimple",
        "inputs": {
          "ckpt_name": "{{checkpoint_name}}"
        }
      },
      "2": {
        "class_type": "CLIPTextEncode",
        "inputs": {
          "text": "{{base_prompt}}, portrait, face close-up, {{expression_prompt}}, wuxia character, manhwa style",
          "clip": ["1", 1]
        }
      },
      "3": {
        "class_type": "CLIPTextEncode",
        "inputs": {
          "text": "{{negative_prompt}}, full body, multiple faces",
          "clip": ["1", 1]
        }
      },
      "4": {
        "class_type": "EmptyLatentImage",
        "inputs": {
          "width": 256,
          "height": 256,
          "batch_size": 1
        }
      },
      "5": {
        "class_type": "KSampler",
        "inputs": {
          "seed": "{{seed}}",
          "steps": 25,
          "cfg": 7.5,
          "sampler_name": "dpmpp_2m",
          "scheduler": "karras",
          "denoise": 1.0,
          "model": ["1", 0],
          "positive": ["2", 0],
          "negative": ["3", 0],
          "latent_image": ["4", 0]
        }
      },
      "6": {
        "class_type": "VAEDecode",
        "inputs": {
          "samples": ["5", 0],
          "vae": ["1", 2]
        }
      },
      "7": {
        "class_type": "SaveImage",
        "inputs": {
          "filename_prefix": "{{output_prefix}}_expression_{{expression_id}}",
          "images": ["6", 0]
        }
      }
    }
  },
  
  "template_variables": {
    "checkpoint_name": "Model checkpoint filename",
    "base_prompt": "Base character description",
    "expression_prompt": "Expression description",
    "negative_prompt": "Negative prompt",
    "seed": "Random seed",
    "output_prefix": "Output filename prefix",
    "background_color": "Sheet background color (hex)",
    "portrait_image": "Path to main portrait image (from 7-layer pipeline)",
    "poses_sheet_image": "Path to poses sheet image",
    "outfits_sheet_image": "Path to outfits sheet image",
    "expression_neutral": "Path to neutral expression image",
    "expression_angry": "Path to angry expression image",
    "expression_happy": "Path to happy expression image",
    "expression_determined": "Path to determined expression image",
    "expression_id": "Expression identifier for individual generation"
  },
  
  "stats_overlay_zones": {
    "description": "Defines zones for frontend TTRPG stat injection",
    "zones": [
      {"name": "character_name", "x": 32, "y": 32, "width": 512, "height": 64},
      {"name": "scl_level", "x": 1376, "y": 336, "width": 256, "height": 48},
      {"name": "pillar_bars", "x": 1376, "y": 400, "width": 256, "height": 200},
      {"name": "stats_block", "x": 1376, "y": 620, "width": 256, "height": 300},
      {"name": "techniques", "x": 1376, "y": 940, "width": 256, "height": 164}
    ]
  }
}
